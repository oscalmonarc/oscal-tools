sudo gpg2 --keyserver hkp://pool.sks-keyservers.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB
# or 
 #command curl -sSL https://rvm.io/mpapis.asc | sudo gpg2 --import -
 #command curl -sSL https://rvm.io/pkuczynski.asc | sudo gpg2 --import -

curl -sSL https://get.rvm.io | bash -s stable --gems=rails,puma
source /etc/profile.d/rvm.sh

sudo adduser monarc
sudo groupadd rvm
sudo usermod -a -G rvm monarc
sudo usermod -a -G rvm "$USER"
rvm user gemsets
rvm get head
rvm reload

#install nodejs bases on OS. https://nodejs.org/en/download/package-manager/
npm install yarn -g

sudo tar -zxvf monarc.tar -C /home/monarc/
sudo chown -R monarc: /home/monarc/

sudo su monarc
	cd /home/monarc/monarc
	unset rvm_path
	curl -sSL https://get.rvm.io | bash -s stable --gems=rails,puma
	rvm group add rvm "$USER"
	rvm user gemsets
	rvm install ruby-2.5.1
	rvm use ruby-2.5.1
	rvm  use 2.5.1 --default
	
	gem install bundler
	gem install puma
	bundle install 
	rake db:setup
	rvm wrapper default systemd rails
exit

# Will only work if you dont have apache running on port 80.
sudo iptables -t nat -I PREROUTING -p tcp --dport 80 -j REDIRECT --to-ports 3001
sudo iptables -t nat -I PREROUTING -p tcp --dport 443 -j REDIRECT --to-ports 3000
sudo iptables -t nat -I PREROUTING -p tcp --dport 3000 -j REDIRECT --to-ports 3000
sudo iptables -t nat -I PREROUTING -p tcp --dport 3000 -j REDIRECT  -p tcp --to-ports 3000
#sudo iptables -t nat -I PREROUTING -p tcp --dport 3001 -j REDIRECT -p ssl --to-ports 3001
sudo iptables-save

rvm wrapper default systemd rails

sudo cp /home/monarch/monarch/InstallDocs/rails-puma.service /etc/systemd/system/
sudo chown root: /etc/systemd/system/rails-puma.service

systemctl enable rails-puma
systemctl start rails-puma



